{{define "content"}}
<div class="dashboard-container">
    <h1>Dashboard</h1>

    {{if .Data.IsEmpty}}
    <div class="empty-state">
        <h2>Get Started</h2>
        <p>Welcome to Roxas! Add your first repository to start automatically generating social media posts from your commits.</p>
        <a href="/repositories/new" class="btn btn-primary">Add Repository</a>
    </div>
    {{else}}

    <section class="dashboard-section">
        <div class="section-header">
            <h2>Repositories</h2>
            <a href="/repositories/new" class="btn btn-primary btn-sm">Add Repository</a>
        </div>
        {{if .Data.Repositories}}
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Repository</th>
                        <th>Added</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Data.Repositories}}
                    <tr>
                        <td><a href="{{.GitHubURL}}" target="_blank">{{.GitHubURL}}</a></td>
                        <td>{{.CreatedAt.Format "Jan 02, 2006"}}</td>
                        <td class="actions-cell">
                            <a href="/repositories/{{.ID}}" class="btn btn-secondary btn-sm">View</a>
                            <a href="/repositories/{{.ID}}/edit" class="btn btn-secondary btn-sm">Edit</a>
                            <a href="/repositories/{{.ID}}/delete" class="btn btn-danger btn-sm">Delete</a>
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        {{else}}
        <p class="empty-message">No repositories yet.</p>
        {{end}}
    </section>

    <section class="dashboard-section">
        <h2>Recent Commits</h2>
        {{if .Data.Commits}}
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>SHA</th>
                        <th>Message</th>
                        <th>Author</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Data.Commits}}
                    <tr>
                        <td><code>{{slice .SHA 0 7}}</code></td>
                        <td>{{.Message}}</td>
                        <td>{{.Author}}</td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        {{else}}
        <p class="empty-message">No commits yet. Commits will appear here when webhooks receive push events.</p>
        {{end}}
    </section>

    <section class="dashboard-section">
        <h2>Generated Posts</h2>
        {{if .Data.Posts}}
        <div class="posts-grid">
            {{range .Data.Posts}}
            <div class="post-card">
                <div class="post-header">
                    <span class="platform-badge">{{.Platform}}</span>
                    {{if eq .Status "draft"}}
                    <span class="status-badge status-draft">Draft</span>
                    {{else if eq .Status "posted"}}
                    <span class="status-badge status-posted">Published</span>
                    {{else if eq .Status "failed"}}
                    <span class="status-badge status-failed">Failed</span>
                    {{else if eq .Status "generation_failed"}}
                    <span class="status-badge status-failed">Generation Failed</span>
                    {{else}}
                    <span class="status-badge status-{{.Status}}">{{.Status}}</span>
                    {{end}}
                </div>
                <p class="post-content">{{.Content}}</p>
                {{if eq .Status "draft"}}
                {{if and (eq .Platform "threads") (not $.Data.HasThreadsConnection)}}
                <div class="post-actions needs-connection">
                    <p class="connect-prompt platform-not-connected">Threads not connected</p>
                    <a href="/connections/new" class="btn btn-primary connect-threads-btn">Connect Threads</a>
                </div>
                {{else}}
                <div class="post-actions">
                    <form action="/posts/{{.ID}}/publish" method="POST" class="publish-form">
                        <button type="submit" class="btn btn-primary publish-btn">Publish to LinkedIn</button>
                    </form>
                </div>
                {{end}}
                {{else if eq .Status "failed"}}
                <div class="post-actions">
                    <form action="/posts/{{.ID}}/retry" method="POST" class="retry-form">
                        <button type="submit" class="btn btn-warning retry-btn">Retry</button>
                    </form>
                </div>
                {{else if eq .Status "generation_failed"}}
                <div class="post-actions">
                    <form action="/posts/{{.ID}}/regenerate" method="POST" class="regenerate-form">
                        <button type="submit" class="btn btn-warning retry-btn">Regenerate</button>
                    </form>
                </div>
                {{end}}
            </div>
            {{end}}
        </div>
        {{else}}
        <p class="empty-message">No posts generated yet. Posts will appear here after commits are processed.</p>
        {{end}}
    </section>

    <section class="dashboard-section">
        <h2>Activity Feed</h2>
        {{if .Data.Activities}}
        <div class="activity-list">
            {{range .Data.Activities}}
            <div class="activity-item activity-{{.Type}}">
                <div class="activity-icon">
                    {{if eq .Type "draft_created"}}
                    <span class="icon-draft">&#x1F4DD;</span>
                    {{else if eq .Type "post_success"}}
                    <span class="icon-success">&#x2705;</span>
                    {{else if eq .Type "post_failed"}}
                    <span class="icon-failed">&#x274C;</span>
                    {{end}}
                </div>
                <div class="activity-content">
                    <div class="activity-type">
                        {{if eq .Type "draft_created"}}
                        <strong>Draft Created</strong>
                        {{else if eq .Type "post_success"}}
                        <strong>Post Published</strong>
                        {{else if eq .Type "post_failed"}}
                        <strong>Post Failed</strong>
                        {{end}}
                        {{if .Platform}}<span class="activity-platform">on {{.Platform}}</span>{{end}}
                    </div>
                    {{if .Message}}
                    <p class="activity-message">{{.Message}}</p>
                    {{end}}
                    <span class="activity-time">{{.CreatedAt.Format "Jan 02, 2006 3:04 PM"}}</span>
                </div>
            </div>
            {{end}}
        </div>
        {{if gt .Data.ActivityTotalPages 1}}
        <div class="pagination">
            {{if gt .Data.ActivityPage 1}}
            <a href="?activity_page={{.Data.ActivityPage | add -1}}" class="btn btn-secondary btn-sm">Previous</a>
            {{else}}
            <span class="btn btn-secondary btn-sm disabled">Previous</span>
            {{end}}
            <span class="page-info">Page {{.Data.ActivityPage}} of {{.Data.ActivityTotalPages}}</span>
            {{if lt .Data.ActivityPage .Data.ActivityTotalPages}}
            <a href="?activity_page={{.Data.ActivityPage | add 1}}" class="btn btn-secondary btn-sm">Next</a>
            {{else}}
            <span class="btn btn-secondary btn-sm disabled">Next</span>
            {{end}}
        </div>
        {{end}}
        {{else}}
        <p class="empty-message">No activity yet. Activity will appear here when drafts are created or posts are published.</p>
        {{end}}
    </section>

    {{end}}
</div>
{{end}}
